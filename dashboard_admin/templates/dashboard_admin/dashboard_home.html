{% extends "dashboard_admin/dashboard_base.html" %}
{% load humanize %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard General{% endblock %}

{% block dashboard_content %}
<!-- Stats Grid - Premium KPI Cards -->
<div class="stats-grid">
    <!-- Total Clientes - Blue Highlight -->
    <div class="stat-card stat-highlight-blue">
        <div class="stat-header">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="stat-value">{{ total_clientes|default:0 }}</div>
        <div class="stat-label">Total Clientes</div>
        <div class="stat-footer">
            <a href="{% url 'dashboard_admin:lista_clientes' %}">Ver todos los clientes <i class="fas fa-arrow-right ms-1"></i></a>
        </div>
    </div>

    <!-- Pólizas Activas - Orange Highlight -->
    <div class="stat-card stat-highlight">
        <div class="stat-header">
            <div class="stat-icon">
                <i class="fas fa-file-contract"></i>
            </div>
        </div>
        <div class="stat-value">{{ total_polizas_activas|default:0 }}</div>
        <div class="stat-label">Pólizas Activas</div>
        <div class="stat-footer">
            <a href="{% url 'dashboard_admin:cartera_general' %}">Ver cartera completa <i class="fas fa-arrow-right ms-1"></i></a>
        </div>
    </div>

    <!-- Por Vencer -->
    <div class="stat-card stat-warning">
        <div class="stat-header">
            <div class="stat-icon icon-warning">
                <i class="fas fa-clock"></i>
            </div>
            {% if polizas_por_vencer > 0 %}
            <span class="stat-trend trend-down">
                <i class="fas fa-exclamation-triangle"></i>
                Atención
            </span>
            {% endif %}
        </div>
        <div class="stat-value">{{ polizas_por_vencer|default:0 }}</div>
        <div class="stat-label">Por Vencer (30 días)</div>
        <div class="stat-footer">
            Requieren seguimiento inmediato
        </div>
    </div>

    <!-- SOAT por Vencer -->
    <div class="stat-card stat-danger">
        <div class="stat-header">
            <div class="stat-icon icon-danger">
                <i class="fas fa-car"></i>
            </div>
            {% if lista_soats_a_vencer|length > 0 %}
            <span class="stat-trend trend-down">
                <i class="fas fa-bell"></i>
                Urgente
            </span>
            {% endif %}
        </div>
        <div class="stat-value">{{ lista_soats_a_vencer|length|default:0 }}</div>
        <div class="stat-label">SOAT por Vencer (15 días)</div>
        <div class="stat-footer">
            <a href="{% url 'dashboard_admin:lista_vehiculos' %}">Ver vehículos <i class="fas fa-arrow-right ms-1"></i></a>
        </div>
    </div>
</div>

<!-- Alerts Section -->
<div class="row g-4">
    <!-- Pólizas por Vencer -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-file-alt"></i>
                    Pólizas Próximas a Vencer
                </h3>
                <span class="badge badge-warning">{{ lista_polizas_a_vencer|length|default:0 }}</span>
            </div>
            <div class="card-body p-0">
                {% if lista_polizas_a_vencer %}
                <ul class="alert-list" style="padding: 0 28px;">
                    {% for poliza in lista_polizas_a_vencer|slice:":5" %}
                    <li class="alert-item">
                        <div class="alert-icon icon-warning">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">{{ poliza.tipo_seguro.nombre }}</div>
                            <div class="alert-description">
                                <strong>#{{ poliza.numero_poliza }}</strong> &middot; {{ poliza.cliente.get_full_name }}
                            </div>
                        </div>
                        <div class="alert-time">
                            <span class="badge badge-warning">{{ poliza.fecha_fin|date:"d M" }}</span>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% if lista_polizas_a_vencer|length > 5 %}
                <div style="padding: 20px 28px; border-top: 1px solid var(--gray-100);">
                    <a href="{% url 'dashboard_admin:cartera_general' %}" class="text-primary fw-semibold" style="font-size: 14px;">
                        Ver todas las {{ lista_polizas_a_vencer|length }} pólizas <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
                {% endif %}
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon" style="background: linear-gradient(135deg, var(--color-success-light) 0%, #a7f3d0 100%);">
                        <i class="fas fa-check-circle" style="color: var(--color-success);"></i>
                    </div>
                    <div class="empty-state-title">Todo en orden</div>
                    <div class="empty-state-description">No hay pólizas próximas a vencer en los próximos 30 días.</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- SOAT por Vencer -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-car"></i>
                    Recordatorios SOAT
                </h3>
                <span class="badge badge-danger">{{ lista_soats_a_vencer|length|default:0 }}</span>
            </div>
            <div class="card-body p-0">
                {% if lista_soats_a_vencer %}
                <ul class="alert-list" style="padding: 0 28px;">
                    {% for vehiculo in lista_soats_a_vencer|slice:":5" %}
                    <li class="alert-item">
                        <div class="alert-icon icon-danger">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Placa: {{ vehiculo.placa }}</div>
                            <div class="alert-description">
                                {{ vehiculo.marca }} {{ vehiculo.modelo }} &middot; {{ vehiculo.cliente.get_full_name }}
                            </div>
                        </div>
                        <div class="alert-time">
                            <span class="badge badge-danger">{{ vehiculo.soat_vencimiento_recordatorio|date:"d M" }}</span>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% if lista_soats_a_vencer|length > 5 %}
                <div style="padding: 20px 28px; border-top: 1px solid var(--gray-100);">
                    <a href="{% url 'dashboard_admin:lista_vehiculos' %}" class="text-primary fw-semibold" style="font-size: 14px;">
                        Ver todos los {{ lista_soats_a_vencer|length }} vehículos <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
                {% endif %}
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon" style="background: linear-gradient(135deg, var(--color-success-light) 0%, #a7f3d0 100%);">
                        <i class="fas fa-check-circle" style="color: var(--color-success);"></i>
                    </div>
                    <div class="empty-state-title">Sin alertas</div>
                    <div class="empty-state-description">No hay recordatorios de SOAT en los próximos 15 días.</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-bolt"></i>
            Acciones Rápidas
        </h3>
    </div>
    <div class="card-body">
        <div class="quick-actions-grid">
            <a href="{% url 'dashboard_admin:crear_cliente' %}" class="quick-action-card">
                <div class="icon icon-primary">
                    <i class="fas fa-user-plus"></i>
                </div>
                <span>Nuevo Cliente</span>
            </a>
            <a href="{% url 'dashboard_admin:lista_clientes' %}" class="quick-action-card">
                <div class="icon icon-success">
                    <i class="fas fa-file-medical"></i>
                </div>
                <span>Nueva Póliza</span>
            </a>
            <a href="{% url 'reportes:panel_reportes' %}" class="quick-action-card">
                <div class="icon icon-info">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <span>Ver Reportes</span>
            </a>
            <a href="{% url 'dashboard_admin:liquidacion_comisiones' %}" class="quick-action-card">
                <div class="icon icon-warning">
                    <i class="fas fa-money-check-alt"></i>
                </div>
                <span>Liquidaciones</span>
            </a>
        </div>
    </div>
</div>

<!-- Recent Activity (Optional Enhancement) -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-history"></i>
            Resumen del Sistema
        </h3>
    </div>
    <div class="card-body">
        <div class="row g-4">
            <div class="col-md-3 col-sm-6">
                <div class="d-flex align-items-center gap-3">
                    <div class="stat-icon icon-primary" style="width: 48px; height: 48px; font-size: 18px;">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-primary" style="font-size: 18px;">ASSECOL</div>
                        <div class="text-muted" style="font-size: 12px;">Sistema Activo</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="d-flex align-items-center gap-3">
                    <div class="stat-icon icon-success" style="width: 48px; height: 48px; font-size: 18px;">
                        <i class="fas fa-database"></i>
                    </div>
                    <div>
                        <div class="fw-bold" style="font-size: 18px; color: var(--color-success);">Online</div>
                        <div class="text-muted" style="font-size: 12px;">Base de Datos</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="d-flex align-items-center gap-3">
                    <div class="stat-icon icon-accent" style="width: 48px; height: 48px; font-size: 18px;">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div>
                        <div class="fw-bold" style="font-size: 18px; color: var(--assecol-orange);">{% now "Y" %}</div>
                        <div class="text-muted" style="font-size: 12px;">Año Fiscal</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="d-flex align-items-center gap-3">
                    <div class="stat-icon icon-info" style="width: 48px; height: 48px; font-size: 18px;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div>
                        <div class="fw-bold" style="font-size: 18px; color: var(--color-info);">{% now "H:i" %}</div>
                        <div class="text-muted" style="font-size: 12px;">Última Actualización</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
