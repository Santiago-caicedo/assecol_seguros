{% extends "dashboard_admin/dashboard_base.html" %}
{% load humanize %}

{% block dashboard_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2">Detalle de Siniestro</h1>
        <p class="text-muted">#{{ siniestro.numero_siniestro }}</p>
    </div>
    <a href="{% url 'dashboard_admin:lista_siniestros' %}" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-arrow-left me-2"></i>Volver a Siniestros
    </a>
</div>

<div class="row">
    <div class="col-lg-7">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
                <h5>Información General</h5>
                <p><strong>Cliente:</strong> {{ siniestro.poliza.cliente.get_full_name }}</p>
                <p><strong>Póliza:</strong> #{{ siniestro.poliza.numero_poliza }} ({{ siniestro.poliza.tipo_seguro.nombre }})</p>
                <p><strong>Fecha del Siniestro:</strong> {{ siniestro.fecha_siniestro|date:"d M, Y" }}</p>
                <p><strong>Estado:</strong> <span class="badge text-bg-info">{{ siniestro.get_estado_display }}</span></p>
                <hr>
                <h5>Descripción</h5>
                <p>{{ siniestro.descripcion|linebreaks }}</p>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header"><h5><i class="fas fa-folder me-2"></i>Documentos</h5></div>
            <div class="card-body">
                <form action="{% url 'dashboard_admin:add_documento_siniestro' siniestro_pk=siniestro.pk %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ documento_form.as_p }}
                    <button type="submit" class="btn btn-primary-assecol btn-sm">Subir Documento</button>
                </form>
                <hr>
                <ul class="list-group list-group-flush">
                    {% for doc in siniestro.documentos.all %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="{{ doc.documento.url }}" target="_blank">{{ doc.descripcion|default:doc.documento.name|truncatechars:30 }}</a>
                        <form action="{% url 'dashboard_admin:delete_documento_siniestro' pk=doc.pk %}" method="post">{% csrf_token %}<button type="submit" class="btn btn-danger btn-sm">&times;</button></form>
                    </li>
                    {% empty %}
                    <li class="list-group-item">No hay documentos.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="card shadow-sm border-0">
            <div class="card-header"><h5><i class="fas fa-camera me-2"></i>Fotos</h5></div>
            <div class="card-body">
                <form action="{% url 'dashboard_admin:add_foto_siniestro' siniestro_pk=siniestro.pk %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ foto_form.as_p }}
                    <button type="submit" class="btn btn-primary-assecol btn-sm">Subir Foto</button>
                </form>
                <div class="row mt-3">
                    {% for foto in siniestro.fotos.all %}
                    <div class="col-4 mb-2">
                        <a href="{{ foto.foto.url }}" target="_blank"><img src="{{ foto.foto.url }}" class="img-fluid rounded"></a>
                    </div>
                    {% empty %}
                    <p class="text-muted">No hay fotos.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}