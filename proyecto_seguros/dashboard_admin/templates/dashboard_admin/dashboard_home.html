{% extends "dashboard_admin/dashboard_base.html" %}

{% block dashboard_content %}
<h1 class="mb-4">Dashboard</h1>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="stat-card">
            <p class="text-secondary text-uppercase">Total de Clientes</p>
            <h1>{{ total_clientes }}</h1>
        </div>
    </div>
    <div class="col-md-4 mb-4">
        <div class="stat-card">
            <p class="text-secondary text-uppercase">Pólizas Activas</p>
            <h1>{{ total_polizas_activas }}</h1>
        </div>
    </div>
    <div class="col-md-4 mb-4">
        <div class="stat-card">
            <p class="text-secondary text-uppercase">Por Vencer (30 días)</p>
            <h1>{{ polizas_por_vencer }}</h1>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-5 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="card-title">Distribución de Pólizas</h5>
                <canvas id="policiesByTypeChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-7 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="card-title">Nuevos Clientes (Últimos 12 meses)</h5>
                <canvas id="newClientsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- GRÁFICO 1: DONA DE PÓLIZAS POR TIPO ---
    const ctxPie = document.getElementById('policiesByTypeChart');
    new Chart(ctxPie, {
        type: 'doughnut',
        data: {
            labels: {{ labels_pie_chart|safe }},
            datasets: [{
                label: 'Cantidad de Pólizas',
                data: {{ data_pie_chart|safe }},
                backgroundColor: [
                    '#123AA9', // Assecol Blue
                    '#FE7C04', // Assecol Orange
                    '#6c757d', // Gray
                    '#303AF3', // Assecol Light Blue
                    '#ffc107'  // Yellow
                ],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                }
            }
        }
    });

    // --- GRÁFICO 2: BARRAS DE NUEVOS CLIENTES ---
    const ctxBar = document.getElementById('newClientsChart');
    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: {{ labels_bar_chart|safe }},
            datasets: [{
                label: 'Nuevos Clientes',
                data: {{ data_bar_chart|safe }},
                backgroundColor: 'rgba(18, 58, 169, 0.7)', // Assecol Blue con transparencia
                borderColor: 'rgba(18, 58, 169, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1 // Asegura que el eje Y vaya de 1 en 1
                    }
                }
            },
            plugins: {
                legend: {
                    display: false // Ocultamos la leyenda para este gráfico
                }
            }
        }
    });
});
</script>
{% endblock %}